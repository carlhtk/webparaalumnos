<form id="frmAlumno" class="p-3">

    <div class="row p-1">
        <div class="col-3 col-md-2">CÓDIGO</div>
        <div class="col-9 col-md-4">
            <input required type="text" class="form-control" id="txtCodigoAlumno" name="txtCodigoAlumno"
                   placeholder="Ej: 009925" maxlength="6" />
            <small class="text-secondary">Debe tener exactamente 6 dígitos.</small>
        </div>
    </div>

    <div class="row p-1">
        <div class="col-3 col-md-2">NOMBRE</div>
        <div class="col-9 col-md-8">
            <input required type="text" class="form-control" id="txtNombreAlumno" name="txtNombreAlumno" />
        </div>
    </div>

    <div class="row p-1">
        <div class="col-3 col-md-2">APELLIDO</div>
        <div class="col-9 col-md-10">
            <input required type="text" class="form-control" id="txtApellidoAlumno" name="txtApellidoAlumno" />
        </div>
    </div>

    <div class="row p-1">
        <div class="col-3 col-md-2">EDAD</div>
        <div class="col-9 col-md-4">
            <input required type="number" class="form-control" id="txtEdadAlumno" name="txtEdadAlumno" min="1" max="120" />
        </div>
    </div>

    <div class="row p-1 mt-3">
        <div class="col-12 text-center">
            <input type="submit" class="btn btn-outline-primary" value="Guardar" />
            <input type="reset" class="btn btn-outline-warning" value="Nuevo" />
            <input type="button" class="btn btn-outline-success" value="Buscar" onclick="abrirVentana('busqueda_alumno')" />
            <button type="button" class="btn btn-secondary btn-lose" data-form="alumno">Cerrar</button>
        </div>
    </div>

</form>

<script>
    var formulario = document.getElementById("frmAlumno");

    if (formulario) {
        formulario.addEventListener('submit', function (e) {
            e.preventDefault();
            guardarAlumno();
        });
    }

    async function guardarAlumno() {
        let idTexto = document.getElementById("txtCodigoAlumno").value;

 
        let esValido = /^[0-9]{6}$/.test(idTexto);

        if (!esValido) {
            alert("⚠️ Error: El código debe ser numérico y tener exactamente 6 dígitos (Ej: 009925).");
            return;
        }

        let datos = {
            id: idTexto, 
            nombre: document.getElementById("txtNombreAlumno").value,
            apellido: document.getElementById("txtApellidoAlumno").value,
            edad: parseInt(document.getElementById("txtEdadAlumno").value)
        };

        try {
            const respuesta = await fetch('/api/Alumnos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(datos)
            });

            if (respuesta.ok) {
                alert("¡Alumno guardado: " + idTexto + "!");
                limpiarDatosAlumno();
            } else {
                let errorTexto = await respuesta.text();
                alert("Error: " + errorTexto);
            }
        } catch (error) {
            console.error(error);
            alert("Error de conexión");
        }
    }

    function limpiarDatosAlumno() {
        document.getElementById("txtCodigoAlumno").value = "";
        document.getElementById("txtNombreAlumno").value = "";
        document.getElementById("txtApellidoAlumno").value = "";
        document.getElementById("txtEdadAlumno").value = "";
    }
</script>